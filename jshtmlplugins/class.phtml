<?php 
/**
 * @category   OntoWiki
 * @package    OntoWiki_extensions_formgenerator
 * @author     Lars Eidam <larseidam@googlemail.com>
 * @author     Konrad Abicht <konrad@inspirito.de>
 * @copyright  Copyright (c) 2011
 * @license    http://opensource.org/licenses/gpl-license.php GNU General Public License (GPL)
 */ 
?>
<?php 
    $classes = array ();
    foreach ($element ['typeparameter'] as $item)
    {
        $classesResult = array();
        if (isset($item['relation']))
            $classesResult = $this->store->sparqlQuery(
                'SELECT ?uri ?label 
                 WHERE {
                     ?uri <'. $item['relation'] .'> <'. $item['class'] .'>.
                     ?uri <http://www.w3.org/2000/01/rdf-schema#label> ?label.
                     FILTER (langmatches(lang(?label), "'. $this->selectedLanguage .'"))
                 };'
            );
        else
        {
            $classesResult = $this->store->sparqlQuery(
                'SELECT ?label 
                 WHERE {
                     <'. $item['class'] .'> <http://www.w3.org/2000/01/rdf-schema#label> ?label.
                     FILTER (langmatches(lang(?label), "'. $this->selectedLanguage .'"))
                 };'
            );
            $classesResult[0]['uri'] = $item['class'];
        }
        $classes = array_merge($classes, $classesResult);
    }
?>
<div class="predicateValue">
    
    <!-- TODO: this is a quickHack, better is that the formgenerator only write tripel that have changend and not to delete all triple of a type an write only the new and changend ones -->
    <!-- if person/patient are edit, the "type person" triple must set because the old one will deleted after update, as well "type patient" -->
    <?php if ('edit' == $this->form->getMode()) { ?>
        <input type="checkbox" class="hidden"  name="<?php echo $element ['name']; ?>" value="http://www.dispedia.de/o/Person" checked="checked"/>
        <?php if ('http://www.dispedia.de/o/Patient' == $this->form->getTargetClass()) { ?>
            <input type="checkbox" class="hidden"  name="<?php echo $element ['name']; ?>" value="http://www.dispedia.de/o/Patient" checked="checked"/>
        <?php } ?>
    <?php } ?>
    <?php foreach ( $classes as $class ) { ?>
        <input type="checkbox" class="predicateValue_Resource" name="<?php echo $element ['name']; ?>" value="<?php echo $class ['uri']; ?>"<?php echo (is_array($element['value']) && false !== array_search($class['uri'], $element['value']) ? ' checked="checked"' : ''); ?>/> <?php echo $class ['label']; ?><br />
    <?php } ?>
</div>
