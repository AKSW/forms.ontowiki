<?php 
/**
 * @category   OntoWiki
 * @package    OntoWiki_extensions_formgenerator
 * @author     Lars Eidam <larseidam@googlemail.com>
 * @author     Konrad Abicht <konrad@inspirito.de>
 * @copyright  Copyright (c) 2011
 * @license    http://opensource.org/licenses/gpl-license.php GNU General Public License (GPL)
 */ 
?>
<?php 
    $classes = array ();
    foreach ($element ['typeparameter'] as $item)
    {
        $classesResult = array();
        if (isset($item['relation'])) {
            $classesResult = $this->store->sparqlQuery(
                'SELECT DISTINCT ?uri 
                WHERE {
                    {
                        {
                            {?uri <'. $item['relation'] .'> <'. $item['class'] .'>.}
                            UNION{
                                _:a <http://www.w3.org/2000/01/rdf-schema#subClassOf> <'. $item['class'] .'>.
                                ?uri <'. $item['relation'] .'> _:a.
                            }
                        }
                        UNION{
                            _:b <http://www.w3.org/2000/01/rdf-schema#subClassOf> <'. $item['class'] .'>.
                            _:c <http://www.w3.org/2000/01/rdf-schema#subClassOf> _:b.
                            ?uri <'. $item['relation'] .'> _:c.
                        }
                    }
                    UNION{
                        _:d <http://www.w3.org/2000/01/rdf-schema#subClassOf> <'. $item['class'] .'>.
                        _:e <http://www.w3.org/2000/01/rdf-schema#subClassOf> _:d.
                        _:f <http://www.w3.org/2000/01/rdf-schema#subClassOf> _:e.
                        ?uri <'. $item['relation'] .'> _:f.
                    }
                };'
            );
            $classes = array_merge($classes, $classesResult);
        }
        else
        {
            $classes[]['uri'] = $item['class'];
        }
    }
    $this->titleHelper->reset();
    foreach ($classes as $class) {
        $this->titleHelper->addResource($class['uri']);
    }
    foreach ($classes as $classNumber => $class) {
        $classes[$classNumber]['label'] = $this->titleHelper->getTitle($class['uri'], $this->selectedLanguage);
    }
    
?>
<div class="predicateValue" <?php echo (isset($element ['typeparameter'][0]['editalbe']) ? "id=\"service\"" : "") ?>>
    <?php if(isset($element ['typeparameter'][0]['editalbe'])) { ?>
        <div class="divClassPredicateValue">
            <a class="button" href="javascript:openBoxForm('#boxes', 'service', '', 'add')">+</a>
        </div>
    <?php } ?>
    <?php foreach ( $classes as $class ) { ?>
        <div class="divClassPredicateValue">
            <div class="divClassPredicateValueInput">
                <input type="checkbox" class="predicateValue_Class" name="<?php echo $element ['name']; ?>" value="<?php echo $class ['uri']; ?>"<?php echo ((is_array($element['value']) && false !== array_search($class['uri'], $element['value'])) || ($class['uri'] == $element['value']) ? ' checked="checked"' : ''); ?>/>
            </div>
                <?php echo $class ['label']; ?>
                
                <?php if(isset($element ['typeparameter'][0]['editalbe'])) { ?>
                    <a href="javascript:openBoxForm('#boxes', 'service', '<?php echo $class ['uri']; ?>', 'edit')"><img src="http://localhost/ow_als/extensions/themes/dispedia/images/icon-edit.png"></a>
                <?php } ?>
                <div class="clear"></div>
        </div>
    <?php } ?>
</div>
