<?php 
/**
 * Template for form action
 * 
 * @category   OntoWiki
 * @package    OntoWiki_extensions_formgenerator
 * @author     Lars Eidam <larseidam@googlemail.com>
 * @author     Konrad Abicht <konrad@inspirito.de>
 * @copyright  Copyright (c) 2011
 * @license    http://opensource.org/licenses/gpl-license.php GNU General Public License (GPL)
 */
?>

<!-- important variables -->
<script type="text/javascript">       
    var url = '<?php echo $this->url; ?>';
    var urlMvc = urlBase + 'formgenerator/';
    
    var data = {};
    $.data(data, "form", <?php echo json_encode ($this->form->getDataAsArrays ()); ?>);
</script>
 

<!-- formula -->
<form id="mainform" method="post" action="">
    
    <div class="content">
        <h2><?php echo $this->form->getTitle(); ?></h2>
    </div>
    
    <?php if('' != $this->form->getDescription()) { ?>
    
    <div class="content">
        <?php echo $this->form->getDescription(); ?>
    </div>    
    
    <?php } ?>
    
    <div class="content">
        <div class="predicateTitle">&nbsp;</div>
        <div class="predicateValue">&nbsp;</div>
    </div>    
        
    <!-- select a resource of a specific type -->
    <?php if (true == isset($this->resourcesOfType)) { ?>
    
        <form method="post" action="<?php echo $this->url; ?>form/">
            <div class="content">
                <div class="predicateTitle">Please select:</div>
                
                <div class="predicateValue">
                    <select name="r">
                        
                        <option value="">- please select -</option>
                
                    <?php foreach ($this->resourcesOfType as $resource) { ?>
                    
                        <?php if ($this->selectedResource == $resource['uri']) { ?>
                        
                            <option value="<?php echo $resource ['uri']; ?>" selected><?php echo $resource ['label']; ?></option>
                            
                        <?php } else { ?>
                            
                            <option value="<?php echo $resource ['uri']; ?>"><?php echo $resource ['label']; ?></option>
                        
                        <?php } ?>
                    
                    <?php } ?>
                
                    </select>
                    <input type="hidden" name="andFile" value="<?php echo $this->form->getXmlFile(); ?>"/>
                </div>
            </div>
            
            
            <div class="content">
                <div class="predicateTitle">&nbsp;</div>
                <div class="predicateValue"><input type="submit" value="Select"></div>
            </div> 
        </form>
    
    <?php } ?>
    
    <?php if (false !== $this->showForm) { ?>
    
    <div class="content">
        <div class="predicateTitle">&nbsp;</div>
        <div class="predicateValue">&nbsp;</div>
    </div> 
    
    <hr>
    
    <!-- sections (predicates and nestedconfigs) -->
    <?php foreach ($this->form->getSections () as $section) { ?>

    <div class="content">
        
        <!-- Title -->
        <h3><?php echo $section ['title']; ?></h3>
        
        <?php foreach ($section as $element) { if (false == isset($element ['sectiontype']) ) continue; ?>
                    
            <?php if ('predicate' == $element ['sectiontype']) { ?>
            <!-- PREDICATE -->
                
                <!-- Predicate title -->        
                <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                
                <?php if ('list' == $element ['type']) { ?>
                
                    <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
            
                <?php } elseif ('resource' == $element ['type']) { ?>
                
                    <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>            
                            
                <?php } elseif ('alsfrsquestion' == $element ['type']) { ?>
                </div>
                    <?php require $this->dirJsHtmlPlugins . 'alsfrsquestion.phtml'; ?>            
                
                <?php } else { ?>
                
                    <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                
                <?php } ?>
                
                <br/>
            
            
            <?php } elseif ('nestedconfig' == $element ['sectiontype']) { ?>
            <!-- NESTEDCONFIG - level 2 ------------------------------------->            
                       
                <?php $oldElement = $element; ?>
                       
                       
                <?php foreach ($oldElement ['form']->getSections () as $section) { ?>
                 
                     <?php foreach ($section as $element) { ?>
                     
                     <?php if (false == is_array($element)) continue; ?>
                     
                        <?php if ('predicate' == $element ['sectiontype']) { ?>
                        <!-- PREDICATE -->
                        
                            <!-- Predicate title -->        
                            <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                            
                            <?php if ('list' == $element ['type']) { ?>
                            
                                <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
                        
                            <?php } elseif ('resource' == $element ['type']) { ?>
                
                                <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>            
                            
                            <?php } else { ?>
                            
                                <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                            
                            <?php } ?>
                            
                            <br/><br/>
                        
                        
                        <?php } elseif ('nestedconfig' == $element ['sectiontype']) { ?>
                        <!-- NESTEDCONFIG - level 3 ------------------------------------->
                        
                            <!-- Title -->
                            <h4><?php echo $element ['form']->getTitle (); ?></h4>
                        
                            <?php $oldElement2 = $element; ?>
                        
                            <?php foreach ($oldElement2 ['form']->getSections () as $section) { ?>
                            
                                <?php foreach ($section as $element) { ?>
                                
                                    <?php if ('predicate' == $element ['sectiontype']) { ?>
                                        <!-- PREDICATE -->
                                        
                                            <!-- Predicate title -->        
                                            <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                                            
                                            <?php if ('list' == $element ['type']) { ?>
                                            
                                                <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
                                        
                                            <?php } elseif ('resource' == $element ['type']) { ?>
                
                                                <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>            
                                            
                                            <?php } else { ?>
                                            
                                                <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                                            
                                            <?php } ?>
                                            
                                            <br/><br/>
                                        
                                        
                                        <?php } ?>
                                
                                <?php } ?>
                            
                            <?php } ?>   
                            
                            <?php $element = $oldElement2; ?>
                            
                        <!-- NESTEDCONFIG - level 3 end -->                    
                        <?php } ?>
                     
                    <?php } ?>
                    
                     
                <?php } ?>
                
                <?php $element = $oldElement; ?>
                
            
            <!-- NESTEDCONFIG - level 2 end -->
            <?php } ?>
            
            <br/>
                       
        <?php } ?>
        
    </div>
        
    <?php } ?>
    
    <a id="changeResource" class="button submit<?php if ( 'new' == $this->form->getMode () ) { echo ' hidden'; } ?>" onclick="submitFormula(urlMvc, data, 'edit');"/>
        <span>Edit</span></a>
    
    <?php if ('' == $this->form->getSelectResourceOfType()) { ?>
    
    <a id="addResource" class="button submit" onclick="submitFormula(urlMvc, data, 'add');"/>
            <span>Add New</span></a>
            
    <?php } ?>
            
    <div id="pleaseWaitBox" class="hidden">Please wait...</div>
    
    <?php } ?>
    
</form>
