<?php 
/**
 * Template for form action
 * 
 * @category   OntoWiki
 * @package    OntoWiki_extensions_formgenerator
 * @author     Lars Eidam <larseidam@googlemail.com>
 * @author     Konrad Abicht <konrad@inspirito.de>
 * @copyright  Copyright (c) 2011
 * @license    http://opensource.org/licenses/gpl-license.php GNU General Public License (GPL)
 */
?>

<!-- important variables -->
<script type="text/javascript">       
    var url = '<?php echo $this->url; ?>';
    var urlMvc = urlBase + 'formgenerator/';
    
    var data = {};
    $.data(data, "form", <?php echo json_encode ($this->form->getDataAsArrays ()); ?>);
</script>

<!-- formular select box -->
<div align="right" class="messagebox">
    <form id="formformlist" method="get" action="">

        <?php echo $this->_translate->_('Available forms:'); ?>

        <select id="selectformlist" name="file">
            <?php
                // Read all XML files in formconfig folder and generate a list.
                foreach ( $this->formList as $file )
                {
                    echo '<option value="'. $file .'" label="'. $file .'"' . ($this->form->getXmlFile() == $file ? ' selected="selected"' : "") . '>' .
                    substr_replace($file, strtoupper(substr($file, 0, 1)), 0, 1) .'</option>' . "\n";
                }
            ?>
        </select>
    </form>
</div>

<script type="text/javascript">       
    $('#selectformlist').change(function() {
        $('#formformlist').submit();
    });
</script>

<!-- formula -->
<form id="mainform" method="post" action="">
    
    <div class="content">
        <h2><?php echo $this->form->getTitle(); ?></h2>
    </div>
    
    <?php if('' != $this->form->getDescription()) { ?>
    
    <div class="content">
        <?php echo $this->form->getDescription(); ?>
    </div>    
    
    <?php } ?>
    
    <div class="content">
        <div class="predicateTitle">&nbsp;</div>
        <div class="predicateValue">&nbsp;</div>
    </div>    
        
    <!-- select a resource of a specific type -->
    <?php if (true == isset($this->resourcesOfType)) { ?>
    
        <form method="post" action="<?php echo $this->url; ?>form/">
            <div class="content">
                <div class="predicateTitle"><?php echo $this->_translate->_('Please select:'); ?></div>
                
                <div class="predicateValue">
                    <select name="r">
                        
                        <option value=""><?php echo $this->_translate->_('please select'); ?></option>
                
                    <?php foreach ($this->resourcesOfType as $resource) { ?>
                    
                        <?php if ($this->selectedResource == $resource['uri']) { ?>
                        
                            <option value="<?php echo $resource ['uri']; ?>" selected><?php echo $resource ['label']; ?></option>
                            
                        <?php } else { ?>
                            
                            <option value="<?php echo $resource ['uri']; ?>"><?php echo $resource ['label']; ?></option>
                        
                        <?php } ?>
                    
                    <?php } ?>
                
                    </select>
                </div>
            </div>
            
            
            <div class="content">
                <div class="predicateTitle">&nbsp;</div>
                <div class="predicateValue"><input type="submit" value="<?php echo $this->_translate->_('Select'); ?>"></div>
            </div> 
        </form>
    
    <?php } ?>
    
    <?php if (false !== $this->showForm) { ?>
    
    <div class="content">
        <div class="predicateTitle">&nbsp;</div>
        <div class="predicateValue">&nbsp;</div>
    </div> 
    
    <hr>
    
    <!-- sections (predicates and nestedconfigs) -->
    <?php foreach ($this->form->getSections () as $section) { ?>

    <div class="content">
        
        <!-- Title -->
        <h3><?php echo $section ['title']; ?></h3>
        
        <?php foreach ($section as $element) { if (false == isset($element ['sectiontype']) ) continue; ?>
                    
            <?php if ('predicate' == $element ['sectiontype']) { ?>
            <!-- PREDICATE -->
                
                <?php if ('list' == $element ['type']) { ?>
                    
                    <!-- Predicate title -->        
                    <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                    <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
            
                <?php } elseif ('resource' == $element ['type']) { ?>
                
                    <!-- Predicate title -->        
                    <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                    <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>            
                            
                <?php } elseif ('class' == $element ['type']) { ?>
                
                    <!-- Predicate title -->        
                    <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                    <?php require $this->dirJsHtmlPlugins . 'class.phtml'; ?>            
                            
                <?php } elseif ('alsfrsquestion' == $element ['type']) { ?>
                
                    <?php require $this->dirJsHtmlPlugins . 'alsfrsquestion.phtml'; ?>            
                
                <?php } else { ?>
                
                    <!-- Predicate title -->        
                    <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                    <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                
                <?php } ?>
                
                <br/>
            
            
            <?php } elseif ('nestedconfig' == $element ['sectiontype']) { ?>
            <!-- NESTEDCONFIG - level 2 ------------------------------------->            
                       
                <?php $oldElement = $element; ?>
                       
                       
                <?php foreach ($oldElement ['form']->getSections () as $section) { ?>
                 
                     <?php foreach ($section as $element) { ?>
                     
                     <?php if (false == is_array($element)) continue; ?>
                     
                        <?php if ('predicate' == $element ['sectiontype']) { ?>
                        <!-- PREDICATE -->
                        
                            <!-- Predicate title -->        
                            <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                            
                            <?php if ('list' == $element ['type']) { ?>
                            
                                <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
                        
                            <?php } elseif ('resource' == $element ['type']) { ?>
                
                                <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>
                                
                            <?php } elseif ('class' == $element ['type']) { ?>
                
                                <?php require $this->dirJsHtmlPlugins . 'class.phtml'; ?>            
                            
                            <?php } else { ?>
                            
                                <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                            
                            <?php } ?>
                            
                            <br/><br/>
                        
                        
                        <?php } elseif ('nestedconfig' == $element ['sectiontype']) { ?>
                        <!-- NESTEDCONFIG - level 3 ------------------------------------->
                        
                            <!-- Title -->
                            <h4><?php echo $element ['form']->getTitle (); ?></h4>
                        
                            <?php $oldElement2 = $element; ?>
                        
                            <?php foreach ($oldElement2 ['form']->getSections () as $section) { ?>
                            
                                <?php foreach ($section as $element) { ?>
                                
                                    <?php if ('predicate' == $element ['sectiontype']) { ?>
                                        <!-- PREDICATE -->
                                        
                                            <!-- Predicate title -->        
                                            <div class="predicateTitle"><?php echo $element ['title']; ?></div>
                                            
                                            <?php if ('list' == $element ['type']) { ?>
                                            
                                                <?php require $this->dirJsHtmlPlugins . 'list.phtml'; ?>
                                        
                                            <?php } elseif ('resource' == $element ['type']) { ?>
                
                                                <?php require $this->dirJsHtmlPlugins . 'resource.phtml'; ?>
                                                
                                            <?php } elseif ('class' == $element ['type']) { ?>
                
                                                <?php require $this->dirJsHtmlPlugins . 'class.phtml'; ?>          
                                            
                                            <?php } else { ?>
                                            
                                                <?php require $this->dirJsHtmlPlugins . 'textfield.phtml'; ?>
                                            
                                            <?php } ?>
                                            
                                            <br/><br/>
                                        
                                        
                                        <?php } ?>
                                
                                <?php } ?>
                            
                            <?php } ?>   
                            
                            <?php $element = $oldElement2; ?>
                            
                        <!-- NESTEDCONFIG - level 3 end -->                    
                        <?php } ?>
                     
                    <?php } ?>
                    
                     
                <?php } ?>
                
                <?php $element = $oldElement; ?>
                
            
            <!-- NESTEDCONFIG - level 2 end -->
            <?php } ?>
            
            <br/>
                       
        <?php } ?>
        
    </div>
        
    <?php } ?>
    
    <a id="changeResource" class="button submit<?php if ( 'new' == $this->form->getMode () ) { echo ' hidden'; } ?>" onclick="submitFormula(urlMvc, data, 'edit');"/>
        <span>Edit</span></a>
    
    <?php if ('' == $this->form->getSelectResourceOfType()) { ?>
    
    <a id="addResource" class="button submit" onclick="submitFormula(urlMvc, data, 'add');"/>
            <span>Add New</span></a>
            
    <?php } ?>
            
    <div id="pleaseWaitBox" class="hidden">Please wait...</div>
    
    <?php } ?>
    
</form>
